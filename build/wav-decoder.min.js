(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var r;if(typeof window!=="undefined"){r=window}else if(typeof global!=="undefined"){r=global}else if(typeof self!=="undefined"){r=self}else{r=this}r.WavDecoder=e()}})(function(){var e,r,n;return function t(e,r,n){function a(i,f){if(!r[i]){if(!e[i]){var u=typeof require=="function"&&require;if(!f&&u)return u(i,!0);if(o)return o(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var c=r[i]={exports:{}};e[i][0].call(c.exports,function(r){var n=e[i][1][r];return a(n?n:r)},c,c.exports,t,e,r,n)}return r[i].exports}var o=typeof require=="function"&&require;for(var i=0;i<n.length;i++)a(n[i]);return a}({1:[function(e,r,n){"use strict";var self={};function t(){self.onmessage=function(e){switch(e.data.type){case"decode":self.decode(e.data.buffer).then(function(e){self.postMessage({type:"decoded",audioData:e},[e.buffers])})["catch"](function(e){self.postMessage({type:"error",message:e.message})});break}};var e={1:"lpcm"};self.decode=function(e){return new Promise(function(n){var t=new r(e);if(t.readString(4)!=="RIFF"){throw new Error("Invalid WAV file")}t.readUint32();if(t.readString(4)!=="WAVE"){throw new Error("Invalid WAV file")}var a=null;var o=null;do{var i=t.readString(4);var f=t.readUint32();switch(i){case"fmt ":a=self.decodeFormat(t,f);break;case"data":o=self.decodeData(t,f,a);break;default:t.skip(f);break}}while(o===null);return n(o)})};self.decodeFormat=function(r,n){var t=r.readUint16();if(!e.hasOwnProperty(t)){throw new Error("Unsupported format in WAV file")}var a={formatId:t,numberOfChannels:r.readUint16(),sampleRate:r.readUint32(),byteRate:r.readUint32(),blockSize:r.readUint16(),bitsPerSample:r.readUint16()};r.skip(n-16);return a};self.decodeData=function(e,r,n){var t=Math.floor(r/n.blockSize);var a=new Array(n.numberOfChannels);for(var o=0;o<n.numberOfChannels;o++){a[o]=new Float32Array(t)}e.readPCM(a,t,n);var i=a.map(function(e){return e.buffer});return{numberOfChannels:n.numberOfChannels,length:t,sampleRate:n.sampleRate,buffers:i}};function r(e){this.buffer=e;this.view=new DataView(e);this.length=e.byteLength;this.pos=0}r.prototype.skip=function(e){for(var r=0;r<e;r++){this.view.getUint8(this.pos++)}};r.prototype.readUint8=function(){var e=this.view.getUint8(this.pos);this.pos+=1;return e};r.prototype.readInt16=function(){var e=this.view.getInt16(this.pos,true);this.pos+=2;return e};r.prototype.readUint16=function(){var e=this.view.getUint16(this.pos,true);this.pos+=2;return e};r.prototype.readUint32=function(){var e=this.view.getUint32(this.pos,true);this.pos+=4;return e};r.prototype.readString=function(e){var r="";for(var n=0;n<e;n++){r+=String.fromCharCode(this.readUint8())}return r};r.prototype.readPCM=function(e,r,n){var t=n.numberOfChannels;var a=0;for(var o=0;o<r;o++){for(var i=0;i<t;i++){a=this.readInt16()/32768;e[i][o]=a}}}}t.self=t.util=self;r.exports=t},{}],2:[function(e,r,n){"use strict";var t=function(e){return e&&e.__esModule?e["default"]:e};var a=function(){function e(e,r){for(var n in r){var t=r[n];t.configurable=true;if(t.value)t.writable=true}Object.defineProperties(e,r)}return function(r,n,t){if(n)e(r.prototype,n);if(t)e(r,t);return r}}();var o=function(e,r){if(!(e instanceof r)){throw new TypeError("Cannot call a class as a function")}};var i=t(e("inline-worker"));var f=t(e("audiodata"));var u=t(e("./decoder-worker"));var s=function(){function e(){o(this,e)}a(e,{decode:{value:function r(e){return new Promise(function(r,n){var t=new i(u,u.self);t.onmessage=function(e){if(e.data.type==="decoded"){var t=e.data.audioData;var a=t.numberOfChannels;var o=t.length;var i=t.sampleRate;var u=t.buffers;var s=new f(a,o,i);s.channelData=u.map(function(e){return new Float32Array(e)});return r(s)}return n(new Error(e.data.message))};t.postMessage({type:"decode",buffer:e},[e])})}}},{canProcess:{value:function n(e){var r=new DataView(e);var n=function(e,n){var t="";for(var a=0;a<e;a++){t+=String.fromCharCode(r.getUint8(a+n))}return t};try{return n(4,0)==="RIFF"&&n(4,8)==="WAVE"}catch(t){}return false}}});return e}();r.exports=s},{"./decoder-worker":1,audiodata:5,"inline-worker":6}],3:[function(e,r,n){"use strict";r.exports=e("./decoder")},{"./decoder":2}],4:[function(e,r,n){"use strict";var t=function(){function e(e,r){for(var n in r){var t=r[n];t.configurable=true;if(t.value)t.writable=true}Object.defineProperties(e,r)}return function(r,n,t){if(n)e(r.prototype,n);if(t)e(r,t);return r}}();var a=function(e,r){if(!(e instanceof r)){throw new TypeError("Cannot call a class as a function")}};var o={decoder:[],encoder:[]};var i=function(){function e(r,n,t){a(this,e);this.numberOfChannels=r;this.length=n;this.duration=n/t;this.sampleRate=t;this.channelData=new Array(r);for(var o=0;o<r;o++){this.channelData[o]=new Float32Array(n)}}t(e,{getChannelData:{value:function r(e){return this.channelData[e]}},toTransferable:{value:function n(){var e=this;var r=e.numberOfChannels;var n=e.length;var t=e.sampleRate;var a=this.channelData.map(function(e){return e.buffer});return{numberOfChannels:r,length:n,sampleRate:t,buffers:a}}}},{install:{value:function i(r){if(typeof r==="function"){if(r.prototype.decode&&typeof r.canProcess==="function"){o.decoder.push(r)}if(r.prototype.encode&&typeof r.canProcess==="function"){o.encoder.push(r)}}return e}},decode:{value:function f(e){if(e&&typeof e.length==="number"){e=new Uint8Array(e).buffer}if(!(e instanceof ArrayBuffer)){return Promise.reject(new TypeError("invalid ArrayBuffer for decoding"))}return new Promise(function(r,n){var t=o.decoder.filter(function(r){return r.canProcess(e)});var a=function(){var o=t.shift();if(!o){return n(new Error("failed to decode"))}(new o).decode(e).then(r,a)};a()})}},encode:{value:function u(r,n){if(!(r instanceof e)){return Promise.reject(new TypeError("invalid ArrayData for encoding"))}return new Promise(function(e,t){var a=o.encoder.filter(function(e){return e.canProcess(n)});var i=function(){var o=a.shift();if(!o){return t(new Error("failed to encode"))}(new o).encode(r,n).then(e,i)};i()})}}});return e}();r.exports=i},{}],5:[function(e,r,n){"use strict";r.exports=e("./audio-data")},{"./audio-data":4}],6:[function(e,r,n){"use strict";r.exports=e("./inline-worker")},{"./inline-worker":7}],7:[function(e,r,n){(function(e){"use strict";var n=function(){function e(e,r){for(var n in r){var t=r[n];t.configurable=true;if(t.value)t.writable=true}Object.defineProperties(e,r)}return function(r,n,t){if(n)e(r.prototype,n);if(t)e(r,t);return r}}();var t=function(e,r){if(!(e instanceof r)){throw new TypeError("Cannot call a class as a function")}};var a=!!(e===e.window&&e.URL&&e.Blob&&e.Worker);var o=function(){function r(n,self){var o=this;t(this,r);if(a){var i=n.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1];var f=e.URL.createObjectURL(new e.Blob([i],{type:"text/javascript"}));return new e.Worker(f)}this.self=self;this.self.postMessage=function(e){setTimeout(function(){o.onmessage({data:e})},0)};setTimeout(function(){n.call(self)},0)}n(r,{postMessage:{value:function o(e){var r=this;setTimeout(function(){r.self.onmessage({data:e})},0)}}});return r}();r.exports=o}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[3])(3)});